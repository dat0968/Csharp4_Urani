<!-- Price Start -->
<h5 class="section-title position-relative text-uppercase mb-3">
    <span class="bg-secondary pr-3">LỌC THEO GIÁ</span>
</h5>
<div class="bg-light p-4 mb-30">
    <form id="priceFilterForm" method="get" action="@Url.Action("Index", "CuaHang")">
        <!-- Sử dụng Context.Request để lấy giá trị từ query string -->
        <input type="hidden" name="minPrice" id="minPrice" value="@Context.Request.Query["minPrice"]">
        <input type="hidden" name="maxPrice" id="maxPrice" value="@Context.Request.Query["maxPrice"]">

        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
            <input type="radio" class="custom-control-input" name="priceRange" value="all" id="price-all" onchange="handleAllPriceSelection()">
            <label class="custom-control-label" for="price-all">TẤT CẢ KHOẢNG GIÁ</label>
        </div>
        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
            <input type="radio" class="custom-control-input" name="priceRange" value="100000-10000000" id="price-1" onchange="submitPriceForm()">
            <label class="custom-control-label" for="price-1">100,000 đ - 10,000,000 đ</label>
        </div>
        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
            <input type="radio" class="custom-control-input" name="priceRange" value="10000000-20000000" id="price-2" onchange="submitPriceForm()">
            <label class="custom-control-label" for="price-2">10,000,000 đ - 20,000,000 đ</label>
        </div>
        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
            <input type="radio" class="custom-control-input" name="priceRange" value="20000000-30000000" id="price-3" onchange="submitPriceForm()">
            <label class="custom-control-label" for="price-3">20,000,000 đ - 30,000,000 đ</label>
        </div>
        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
            <input type="radio" class="custom-control-input" name="priceRange" value="30000000-40000000" id="price-4" onchange="submitPriceForm()">
            <label class="custom-control-label" for="price-4">30,000,000 đ - 40,000,000 đ</label>
        </div>
        <div class="custom-control custom-radio d-flex align-items-center justify-content-between">
            <input type="radio" class="custom-control-input" name="priceRange" value="40000000-50000000" id="price-5" onchange="submitPriceForm()">
            <label class="custom-control-label" for="price-5">40,000,000 đ - 50,000,000 đ</label>
        </div>
    </form>

    <div id="selectedPrices" class="mt-3">
        <!-- Hiển thị khoảng giá đã chọn ở đây -->
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var minPrice = document.getElementById('minPrice').value.split(',');
        var maxPrice = document.getElementById('maxPrice').value.split(',');

        minPrice.forEach(function (min, index) {
            var max = maxPrice[index];
            if (min && max) {
                var rangeradio = document.querySelector(`input[name="priceRange"][value="${min}-${max}"]`);
                if (rangeradio) {
                    rangeradio.checked = true;
                }
            }
        });

        // Nếu không có radio nào được chọn, chọn "TẤT CẢ KHOẢNG GIÁ"
        var selectedRanges = document.querySelectorAll('input[name="priceRange"]:checked');
        if (selectedRanges.length === 0) {
            document.getElementById("price-all").checked = true;
        }
    });

    function handleAllPriceSelection() {
        var allPriceradio = document.getElementById("price-all");
        var otherradioes = document.querySelectorAll('input[name="priceRange"]:not(#price-all)');

        if (allPriceradio.checked) {
            otherradioes.forEach(function (radio) {
                radio.checked = false;
            });
            submitPriceForm(); // Gửi form khi chọn "Tất cả khoảng giá"
        } else if (!Array.from(otherradioes).some(radio => radio.checked)) {
            allPriceradio.checked = true; // Chọn lại "Tất cả khoảng giá" nếu không có khoảng giá nào khác được chọn
            submitPriceForm();
        }
    }

    function submitPriceForm() {
        var allPriceradio = document.getElementById("price-all");
        var selectedRanges = document.querySelectorAll('input[name="priceRange"]:checked');
        var selectedText = [];
        var minPrice = [];
        var maxPrice = [];

        // Nếu chọn bất kỳ khoảng giá nào khác, bỏ chọn "Tất cả khoảng giá"
        if (selectedRanges.length > 0) {
            allPriceradio.checked = false;
        }

        selectedRanges.forEach(function (radio) {
            if (radio.value !== "all") {
                var rangeValues = radio.value.split('-');
                if (rangeValues.length === 2) {
                    minPrice.push(rangeValues[0]);
                    maxPrice.push(rangeValues[1]);
                    selectedText.push(radio.nextElementSibling.innerText);
                }
            }
        });

        // Nếu không có khoảng giá nào khác được chọn, giữ "Tất cả khoảng giá"
        if (selectedText.length === 0) {
            allPriceradio.checked = true;
            selectedText.push("TẤT CẢ KHOẢNG GIÁ");
        }

        // Cập nhật giá trị vào các hidden fields
        document.getElementById('minPrice').value = minPrice.join(',');
        document.getElementById('maxPrice').value = maxPrice.join(',');

        // Cập nhật thông tin đã chọn
        var displayText = selectedText.length > 0 ? 'Đã chọn: ' + selectedText.join(', ') : 'Chưa chọn khoảng giá nào';
        document.getElementById('selectedPrices').innerText = displayText;

        // Gửi form
        document.getElementById('priceFilterForm').submit();
    }
</script>


<!-- Price End -->
<!-- Color Start -->
<h5 class="section-title position-relative text-uppercase mb-3"><span class="bg-secondary pr-3">LỌC THEO MÀU SẮC</span></h5>
<div class="bg-light p-4 mb-30">
    <vc:maus></vc:maus>
</div>
<!-- Color End -->
<!-- Size Start -->
<h5 class="section-title position-relative text-uppercase mb-3"><span class="bg-secondary pr-3">LỌC THEO KÍCH THƯỚC</span></h5>
<div class="bg-light p-4 mb-30">
    <vc:kich-thuocs></vc:kich-thuocs>
</div>
<!-- Size End -->
